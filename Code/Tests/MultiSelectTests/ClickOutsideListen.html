<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>Click Outside Close Demo</title>
    <style>
        body {
            height: 200vh;
            padding: 40px;
            font-family: sans-serif;
        }

        button {
            padding: 8px 14px;
            cursor: pointer;
        }

        .dialog {
            position: fixed;
            top: 120px;
            left: 120px;
            width: 240px;
            padding: 16px;
            background: white;
            border: 1px solid #ccc;
            box-shadow: 0 6px 20px rgba(0, 0, 0, .15);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <button id="openBtn">æ‰“å¼€å¯¹è¯æ¡†</button>

    <div id="dialog" class="dialog hidden">
        <strong>æˆ‘æ˜¯å¯¹è¯æ¡†</strong>
        <p>ç‚¹æˆ‘é‡Œé¢ä¸ä¼šå…³é—­</p>
    </div>

    <script>
        const openBtn = document.getElementById("openBtn");
        const dialog = document.getElementById("dialog");

        let isOpen = false;
        let onDocumentPointerDown = null;

        function openDialog() {
            if (isOpen) return;
            isOpen = true;
            dialog.classList.remove("hidden");

            // âš ï¸ åªåœ¨æ‰“å¼€æ—¶ç»‘å®šä¸€æ¬¡
            onDocumentPointerDown = (e) => {
                const target = e.target;

                // ç‚¹å‡»åœ¨å¯¹è¯æ¡†å†… or è§¦å‘æŒ‰é’®ä¸Š â†’ ä¸å…³é—­
                if (dialog.contains(target) || openBtn.contains(target)) {
                    return;
                }

                // ç‚¹å‡»å¤–éƒ¨ â†’ å…³é—­
                closeDialog();
            };

            // capture = trueï¼Œé˜²æ­¢è¢«å†…éƒ¨ stopPropagation å½±å“
            document.addEventListener("pointerdown", onDocumentPointerDown, true);
        }

        function closeDialog() {
            if (!isOpen) return;
            isOpen = false;
            dialog.classList.add("hidden");

            // ğŸ”¥ å…³é—­åç«‹åˆ»è§£ç»‘
            document.removeEventListener("pointerdown", onDocumentPointerDown, true);
            onDocumentPointerDown = null;
        }

        openBtn.addEventListener("click", () => {
            openDialog();
        });
    </script>

</body>
</html>